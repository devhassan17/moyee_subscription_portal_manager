<?xml version="1.0" encoding="UTF-8"?>
<odoo>

    <!-- Add Delete column header ONLY on subscription page table -->
    <template id="moyee_subscription_add_delete_header"
              inherit_id="sale.sale_order_portal_content">
        <xpath expr="//table[contains(@class,'table')]/thead/tr" position="inside">
            <th t-if="page_name == 'subscription'" class="text-end">Action</th>
        </xpath>
    </template>

    <!-- Add Delete button + hide removed/zero lines ONLY on subscription page -->
    <template id="moyee_subscription_portal_lines_delete_btn"
              inherit_id="sale.sale_order_portal_content">

        <!-- Hide removed / zero qty lines -->
        <xpath expr="//t[@t-foreach='lines_to_report']/tr" position="attributes">
            <attribute name="t-if">page_name != 'subscription' or (not getattr(line, 'x_moyee_is_removed', False) and line.product_uom_qty &gt; 0)</attribute>
        </xpath>

        <!-- Add button cell on product rows only -->
        <xpath expr="//t[@t-foreach='lines_to_report']/tr/t[@name='product_line_row']" position="after">
            <td t-if="page_name == 'subscription'" class="text-end">
                <a t-attf-href="/my/subscription/#{sale_order.id}/line/#{line.id}/remove?access_token=#{sale_order.access_token}"
                   class="btn btn-sm btn-danger">
                    Delete
                </a>
            </td>
        </xpath>

    </template>

</odoo>